# QSlice: Quantum Program Slicing via Quantum Dependency Graphs

This repository provides an **experimental quantum program slicing infrastructure** built on top of **QStatic**.

QSlice:
- parses OpenQASM programs via **QStaticâ€™s srcML-based representation**,
- constructs a **Quantum Dependency Graph (QDG)** capturing wire and entanglement dependencies,
- supports **forward and backward slicing** over quantum operations, and
- **visualizes the QDG and slices** using Graphviz.

> âš ï¸ **Note**  
> QStatic and srcML support for OpenQASM is still evolving. Some XML files are manually annotated with position (`pos`) attributes to enable precise slicing.

---

## âœ¨ Key Capabilities

- **Quantum Dependency Graph (QDG)**
  - Nodes represent quantum operations (gate calls, control events, measurements)
  - Edges capture:
    - *Wire dependencies* (sequential operations on a qubit)
    - *Entanglement dependencies* (multi-qubit gates such as `cx`)
- **Forward and Backward Quantum Slicing**
  - Slice with respect to a **qubit**, **program point (line)**, or **operation**
- **Graph-based Visualization**
  - Full QDG visualization
  - Slice-aware highlighting

---

## âš™ï¸ Requirements

- Python **3.9+**
- **srcML**
- **Graphviz** (`dot`)

### macOS Installation
```bash
brew install srcml graphviz
ğŸ“ Repository Structure
.
â”œâ”€â”€ qslice.py        # QDG construction + slicing logic
â”œâ”€â”€ parser.py                # QStatic parser (from QStatic project)
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ hadamard_cnot.qasm
â”‚   â”œâ”€â”€ hadamard_cnot.qasm.xml
â”‚   â”œâ”€â”€ chain3.qasm
â”‚   â””â”€â”€ chain3.qasm.xml
â”œâ”€â”€ out.json                 # Generated by parser.py
â”œâ”€â”€ slice.json               # Generated slice result
â””â”€â”€ qdg.dot / qdg.png        # QDG visualization
â–¶ï¸ Step 1: Generate QStatic out.json
Given a srcML-marked OpenQASM file:
python3 parser.py examples/chain3.qasm.xml
This produces:
out.json
Inspect Parsed Actions
python3 - <<'PY'
import json
out=json.load(open("out.json"))
for q,info in out.items():
    if isinstance(info, dict) and "actions" in info:
        print(q)
        for a in info["actions"]:
            print(" ", a)
PY
ğŸ§© Step 2: Build the Quantum Dependency Graph (QDG)
Export the QDG as a DOT file:
python3 qslice.py --export-dot
Convert to an image:
dot -Tpng -Gdpi=300 qdg.dot -o qdg.png
open qdg.png
ğŸ”™ Step 3: Compute a Backward Slice
Example: backward slice for the target qubit of
cx q2, q3 at line 11
python3 qslice.py \
  --qubit q3 --line 11 --direction backward \
  --export-dot --dot-highlight-slice
Render the slice:
dot -Tpng -Gdpi=300 qdg.dot -o qdg_backward.png
open qdg_backward.png
This highlights all quantum operations that can influence the selected slicing criterion.
ğŸ”œ Step 4: Compute a Forward Slice
Example: forward slice starting from
cx q1, q2 (target qubit q2, line 10)
python3 qslice.py \
  --qubit q2 --line 10 --direction forward \
  --export-dot --dot-highlight-slice
Render:
dot -Tpng -Gdpi=300 qdg.dot -o qdg_forward.png
open qdg_forward.png
This highlights all operations influenced by the selected criterion.
ğŸ§¾ Step 5: Print Slice in QASM-like Form
After slicing, slice.json contains the extracted slice.
To print it in QASM-like syntax:

python3 - <<'PY'
import json
from collections import defaultdict

d=json.load(open("slice.json"))
by_line=defaultdict(list)
for a in d["slice_actions"]:
    by_line[a["line"]].append(a)

for line in sorted(by_line):
    acts=by_line[line]
    ctrl = next((x for x in acts if x["action"]=="ctrl"), None)
    targ = next((x for x in acts if x["action"]=="ctrl-gate-call"), None)
    if ctrl and targ:
        print(f"line {line}: cx {ctrl['qubit']}, {targ['qubit']};")
    else:
        for a in acts:
            if a["action"]=="gate-call":
                print(f"line {line}: {a['gate']} {a['qubit']};")
            elif a["action"]=="measure":
                print(f"line {line}: measure {a['qubit']} -> {a.get('store','?')};")
PY
ğŸ§  Conceptual Model
Nodes: quantum operations (gate calls, control events, measurements)
Wire edges: sequential dependencies on the same qubit
Entanglement edges: multi-qubit gate coupling (e.g., cx)
Backward slice: operations that can influence a slicing criterion
Forward slice: operations that are influenced by a slicing criterion
ğŸ§ª Status
QSlice is a research prototype intended for:
exploring quantum slicing semantics,
studying dependency propagation via entanglement, and
serving as a foundation for future quantum program analysis and CIA tools.
ğŸ”— Relationship to QStatic
QSlice builds on top of QStatic:
QStatic handles parsing and low-level action extraction
QSlice introduces dependency modeling, slicing, and visualization
QSlice does not replace QStatic â€” it extends it.
